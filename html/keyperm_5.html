<div class="container">

<table style="width: 100%;"><tr>
<td>keyperm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the permutation distribution for a keyness measure</h2>

<h3>Description</h3>

<p>Calculate the permutation distributions of a given keyness measure for each term by 
shuffeling the copus labels. Number of documents per corpus is kept constant.
</p>


<h3>Usage</h3>

<pre><code class="language-R">keyperm(ifl, observed, type = "llr", laplace = 1, output = "counts", nperm)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ifl</code></td>
<td>
<p>Indexed frequency list as generated by <code>create_ifl()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>observed</code></td>
<td>
<p>The vector of observed values of the keyness scores as generarted by <code>keyness_scores()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>The type of keyness measure. One of <code>llr</code>, <code>chisq</code>, <code>diff</code>, <code>logratio</code> or <code>ratio</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>laplace</code></td>
<td>
<p>Parameter of laplace correction. Only relevant for <code>type = "ratio"</code> and <code>type = "logratio"</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>The type of output. For <code>output = "full"</code> a matrix with all generated scores is returned,
for <code>output = "counts"</code> a matrix with three columns counting the number of permutations for which the 
score is strictly smaller than, equal to or strictly larger than the observed value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm</code></td>
<td>
<p>The number of permutations to generate.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>While usually keyness scores are judged by reference to a limiting null distribution
under a token-by-token-sampling model, this implementation approximates the null distribution under
a document-by-document sampling model. The permutation distributions of a given keyness measure for 
each term is calculated by repeatedly shuffeling the copus labels. 
Number of documents per corpus is kept constant.
</p>
<p>Currently, the following types of scores are supported:
</p>

<dl>
<dt><code>llr</code></dt>
<dd>
<p>The log-likelihood ratio</p>
</dd>
<dt><code>chisq</code></dt>
<dd>
<p>The Chi-Square-Statistic</p>
</dd>
<dt><code>diff</code></dt>
<dd>
<p>Difference of relative frequencies</p>
</dd>
<dt><code>logratio</code></dt>
<dd>
<p>Binary logarithm of the ratio of the relative frequencies, possibly using a laplace correction to avoid infinite values.</p>
</dd>
<dt><code>ratio</code></dt>
<dd>
<p>ratio of the relative frequencies, possibly using a laplace correction to avoid infinite values.</p>
</dd>
</dl>
<p><code>llr</code> and <code>chisq</code> are the test-statistics for a two-by-two contingency table. 
</p>

<table>
<tr>
<td style="text-align: right;">
</td>
<td style="text-align: center;"> corpus A   </td>
<td style="text-align: center;"> corpus B </td>
<td style="text-align: center;"> TOTAL</td>
</tr>
<tr>
<td style="text-align: right;">
term of interest </td>
<td style="text-align: center;"> <code class="reqn">o_{11}</code>  </td>
<td style="text-align: center;"> <code class="reqn">o_{12}</code> </td>
<td style="text-align: center;"> <code class="reqn">r_{1}</code>
</td>
</tr>
<tr>
<td style="text-align: right;">
other tokens </td>
<td style="text-align: center;"> <code class="reqn">o_{21}</code>    </td>
<td style="text-align: center;"> <code class="reqn">o_{22}</code> </td>
<td style="text-align: center;"> <code class="reqn">r_{2}</code>
</td>
</tr>
<tr>
<td style="text-align: right;">
TOTAL </td>
<td style="text-align: center;"> <code class="reqn">c_{1}</code>    </td>
<td style="text-align: center;"> <code class="reqn">c_{2}</code> </td>
<td style="text-align: center;"> N</td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<p>Both measure deviations from equal proportions but do not indicate the direction. 
For <code>llr</code>, the correct version using terms for all four fields of the table is used, 
not the version using only two terms that is sometimes used in corpus linguistics:
</p>
<p style="text-align: center;"><code class="reqn">llr = -2 * (o11 * log(o11/e11) + o12 * log(o12/e12) + 
o21 * log(o21/e21) + o22 * log(o22/e22))</code>
</p>

<p>where <code class="reqn">oij * log(oij/eij) = 0</code> if <code class="reqn">oij = 0</code>.
</p>
<p><code>chisq</code> is the usual Chi-Square statistic for a test of independece / homogeneity:
</p>
<p style="text-align: center;"><code class="reqn">chisq = (o11 - e11)^2/e11 + (o12 - e12)^2/e12 + 
(o21 - e21)^2/e21 + (o22 - e22)^2/e22</code>
</p>

<p>Both <code>llr</code> and <code>chisq</code> asymptotically follow a Chi-Square-Distribution 
with 1 degree of freedom if the null hypothesis of equal frequencies in both
populations is true and the corpora are drawn iid token-by-token. In contrast,
In contrast, the p-values calculated here are obtained based on a document-by-document 
sampling model, which is arguably more realistic in many cases. 
</p>
<p>Here, <code class="reqn">oij</code> are the observed counts as given above and <code class="reqn">eij</code>
are the correpsonding expected values under an independence / homogeneity assumption.   
</p>
<p><code>diff</code> and <code>logratio</code> are measures of the effect size, 
but using the permutation approach implemented here a p-value can
be calculated as well. Both indicate the direction of the effect,
and can be used for one- or two-sided tests. 
</p>
<p style="text-align: center;"><code class="reqn">diff = o11 / c1 - o12 / c2</code>
</p>

<p><code>logratio</code> is based on a ratio of ratios and would be infinite when a term does not occur in either of the two corpora, irrespective of number of occurences in the other corpus. Hence, we use a laplace correction adding a (not neccesarily integer) number <code class="reqn">k</code> of ficticious occurences to both corpora: 
</p>
<p style="text-align: center;"><code class="reqn">logratio = log2( ((o11 + k) / (c1 + k)) / ((o12 + k) / (c2 + k)) )</code>
</p>

<p>where <code class="reqn">o11</code> and <code class="reqn">o12</code> are the number of occurences of the term of interest in Corpora A and B 
and <code class="reqn">c1</code> and <code class="reqn">c2</code> are the total numbers of tokens in A and B. 
Setting <code class="reqn">k</code> to zero corresponds to the usual logratio (which may be 
infinite). <code class="reqn">k</code> is given by the <code>laplace</code> argument and 
defaults to one, meaning one ficticious occurence is added to 
either corpus. Doing so prevents infinite values but has little 
effect when the number of occurences is large.  
</p>
<p><code>ratio</code> is the same as <code>logratio</code> but omits the logarithm:
</p>
<p style="text-align: center;"><code class="reqn">ratio = ((o11 + k) / (c1 + k)) / ((o12 + k) / (c2 + k)) </code>
</p>

<p>This leads to the same p-values but is faster to compute.
</p>


<h3>Value</h3>

<p>A numeric matrix with number of rows equal to the number of terms. The columns contain either all permutation values
of the keyness score (<code>output = "full"</code>) or the number of permutations for which the 
score is strictly smaller than, equal to or strictly larger than the observed value (<code>output = "counts"</code>).
</p>


</div>